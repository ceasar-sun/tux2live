# This file causes modules to be loaded for inserted devices.
# See udev(7) for syntax.
#
# This file should only specify rules that cause modprobe to be called,
# programs that configure or activate hardware should be called in
# 80-programs.rules

ACTION!="add", GOTO="modprobe_end"

# Load IDE class modules based on the media type
SUBSYSTEM!="ide", GOTO="ide_end"
IMPORT{program}="ide_media --export $devpath"
ENV{IDE_MEDIA}=="cdrom",		RUN+="/sbin/modprobe -q ide_cd"
ENV{IDE_MEDIA}=="disk",			RUN+="/sbin/modprobe -q ide_disk"
#ENV{IDE_MEDIA}=="floppy",		RUN+="/sbin/modprobe -q ide_floppy"
ENV{IDE_MEDIA}=="tape",			RUN+="/sbin/modprobe -q ide_tape"
LABEL="ide_end"

# Load i2o class modules unequivocably until we know more about them
SUBSYSTEM=="i2o",			RUN+="/sbin/modprobe -q i2o-block"

# Load MMC class modules unequivocably until we know more about them
SUBSYSTEM=="mmc",			RUN+="/sbin/modprobe -q mmc-block"

# Load PNP modules with a helper that iterates the device ids
SUBSYSTEM=="pnp", PROGRAM="pnp_modules $devpath", RUN+="/sbin/modprobe -q $result"

# Load SCSI class modules based on the device class
SUBSYSTEM!="scsi", GOTO="scsi_end"
ATTR{type}=="0|7|14",   		RUN+="/sbin/modprobe -q sd_mod"
ATTR{type}=="1",        		RUN+="/sbin/modprobe -q st"
ATTR{type}=="[345]",    		RUN+="/sbin/modprobe -q sr_mod"
RUN+="/sbin/modprobe -q sg"
LABEL="scsi_end"

# Load VIO modules based on the device type
# (modules that lack modalias support)
SUBSYSTEM!="vio", GOTO="vio_end"
IMPORT{program}="vio_type --export $devpath"
ENV{VIO_TYPE}=="serial",		RUN+="/sbin/modprobe -q hvc_console"
ENV{VIO_TYPE}=="serial-server",		RUN+="/sbin/modprobe -q hvcs"
ENV{VIO_TYPE}=="network",		RUN+="/sbin/modprobe -q ibmveth"
ENV{VIO_TYPE}=="vscsi",			RUN+="/sbin/modprobe -q ibmvscsic"
ENV{VIO_TYPE}=="vlan",			RUN+="/sbin/modprobe -q iseries_veth"
ENV{VIO_TYPE}=="viodasd",		RUN+="/sbin/modprobe -q viodasd"
ENV{VIO_TYPE}=="viocd",			RUN+="/sbin/modprobe -q viocd"
LABEL="vio_end"

# Hack to load ti flashmedia subsystem drivers
SUBSYSTEM!="tifm", GOTO="tifm_end"
RUN+="/sbin/modprobe -q tifm_sd"
RUN+="/sbin/modprobe -q tifm_ms"
LABEL="tifm_end"

# Load drivers that match kernel-supplied alias
ENV{MODALIAS}=="?*",			RUN+="/sbin/modprobe -q $env{MODALIAS}"

LABEL="modprobe_end"
